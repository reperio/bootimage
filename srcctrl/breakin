##
# Get a known-good copy of:
# breakin
# 

. ./functions

GITURL="ssh://${SUDO_USER}@jupiter.corp.advancedclustering.com/home/git/breakin.git"
DIRNAME='breakin'

fetch () { 
  git_fetch ${GITURL} ${DIRNAME}
}

unpack () {
  # nothing to do here..
  return  
}

build () {
  cd ${SRCDIR}/${DIRNAME}
  make
}

install () {
  # appears to assume that hpl and mpi were already staged

  mkdir -v ${STAGEDIR}/usr/local/breakin
  if [ $? != 0 ]; then
    echo "Mkdir for breakin failed. Please check $0"
    exit 1
  fi

  cp -vp src/breakin/breakin ${STAGEDIR}/usr/local/bin/breakin
  if [ $? != 0 ]; then
    echo "Copy breakin binary failed. Please check $0"
    exit 1
  fi
  
  #FIXME the worst part of this project
  #cp -vpr src/breakin/breakin_stage/* ${STAGEDIR}/usr/local/breakin/
  #if [ $? != 0 ]; then
  #  echo "Copy breakin deps failed. Please check $0"
  #  exit 1
  #fi
}

$1 $2

if [ $? != 0 ]; then
  printf 'Source control script %s failed on function %s' $0 $1
  exit 1
fi


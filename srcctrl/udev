##
# Get a known-good copy of:
# udev
# 

. ./functions

FILENAME='udev-164.tar.bz2'
URL='http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev-164.tar.bz2'
DIRNAME='udev-164'

BINARIES="\
udev/udevadm \
extras/cdrom_id/cdrom_id \
extras/scsi_id/scsi_id \
extras/path_id/path_id \
extras/firmware/firmware"

SBINARIES="\
udev/udevd"

build () {
  checkdone
  cd ${SRCDIR}/${DIRNAME}
  ./configure --disable-introspection
  make clean
  make
  if [ $? != 0 ]; then
    return 1
  fi
  make EXTRAS="extras/cdrom_id extras/scsi_id extras/volume_id"
  if [ $? != 0 ]; then
    return 1
  fi
  markdone
}

install () {
  cd ${SRCDIR}/${DIRNAME}
  for file in ${BINARIES}; do
    cp -vp ${file} ${STAGEDIR}/usr/bin
    if [ $? != 0 ]; then
      echo "Copying a required binary ${file} failed. Please check $0"
      return 1
    fi
  done

  for file in ${SBINARIES}; do
    cp -vp ${file} ${STAGEDIR}/usr/sbin
    if [ $? != 0 ]; then
      echo "Copying a required sbin binary ${file} failed. Please check $0"
      return 1
    fi
  done
  
  ln -s udevadm ${STAGEDIR}/usr/bin/udevtrigger
}

$1 $2

if [ $? != 0 ]; then
  printf 'Source control script %s failed on function %s' $0 $1
  exit 1
fi


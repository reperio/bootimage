##
# Get a known-good copy of:
# actdmi
# 

. ./functions

DIRNAME="amiflashdrv"
# KERNELVER is set globally in configure.in 
#KERNEL_VER="3.19.0"
KERNEL_DIR="linux-${KERNELVER}"

fetch () { 
 # git_fetch ${GITURL} ${DIRNAME}
 return
}

unpack () {
  # nothing to do here..
  return  
}

build () {
  checkdone


  cd ${SRCDIR}/${DIRNAME}

  rm -f ${SRCDIR}/${DIRNAME}/amifldrv_mod.o

  # tell the binary to make the source code
  echo ./SCELNX_64 /MAKEDRV KERNEL=${SRCDIR}/${KERNEL_DIR}
  ./SCELNX_64 /MAKEDRV KERNEL=${SRCDIR}/${KERNEL_DIR}

  if [ ! -e ${SRCDIR}/${DIRNAME}/amifldrv_mod.o ]
  then
	echo 'Failed to build amifldrv_mod.o'
	return 1
  fi

}

install() {
	mkdir -p ${STAGEDIR}/lib/modules/${KERNELVER}/
	cp ${SRCDIR}/${DIRNAME}/amifldrv_mod.o ${STAGEDIR}/lib/modules/${KERNELVER}/amifldrv_mod.o
}

$1 $2

if [ $? != 0 ]; then
  printf 'Source control script %s failed on function %s' $0 $1
  exit 1
fi

